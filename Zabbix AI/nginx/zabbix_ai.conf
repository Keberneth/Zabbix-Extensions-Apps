server {
    listen      80;
    server_name zabbix-ai.example.se;
    return 301  https://$server_name$request_uri;
}

# ────────────────────────────────────────────────────────────────
# 2) HTTPS-servern
# ----------------------------------------------------------------
server {
    listen      443 ssl http2;
    server_name zabbix-ai.example.se;

    # -- Certifikat (självsignerat i detta exempel) --------------
    ssl_certificate     /etc/pki/selfsigned/zabbix-ai.example.se.pem;
    ssl_certificate_key /etc/pki/selfsigned/zabbix-ai.example.se.key;

    # -- Webbrot --------------------------------------------------
    # Lägg här dina AI-genererade HTML-rapporter + din egna index.html
    root   /usr/share/zabbix/ai;
    index  index.html;

    # ── 2.1  Katalog-/fil-listning på  /_list/  ─────────────────
    #  Ex: https://zabbix-ai.example.se/_list/
    #  alias byter ut hela prefixet och MÅSTE sluta med /
    location = /_list            { return 301 /_list/; }

    location /_list/ {
        alias  /usr/share/zabbix/ai/problems/;
        autoindex            on;
        autoindex_exact_size off;   # KB/MB/GB i stället för byte
        autoindex_localtime  on;    # serverns tidszon
    }

    # ── 2.2  Vanliga anrop (SPA/statiska filer) ─────────────────
    location / {
        # 1) exakt fil  2) katalog  3) fil.html  4) 404
        try_files $uri $uri/ $uri.html =404;
    }

    # ── 2.3  Egna felsidor (valfritt) ───────────────────────────
    error_page 404              /404.html;
    error_page 502 503 504      /50x.html;

    location = /404.html { root /usr/share/nginx/html; }
    location = /50x.html { root /usr/share/nginx/html; }

    # ── 2.4  Gzip (valfritt men bra) ─────────────────────────────
    gzip  on;
    gzip_types
        text/plain
        text/css
        text/javascript
        application/javascript
        application/json
        application/xml
        application/rss+xml
        application/vnd.ms-fontobject
        application/x-font-ttf
        font/opentype
        image/svg+xml;
}
